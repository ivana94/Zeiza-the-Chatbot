// REQUIRE AND SET UP SPICEDPG
const spicedPg = require("spiced-pg");
var db;

if (process.env.DATABASE_URL) {
    db = spicedPg(process.env.DATABASE_URL);
} else {
    const secrets = require("./secrets.json");
    const user = secrets.username;
    const pass = secrets.password;
    db = spicedPg(`postgres:${user}:${pass}psql@localhost:5432/chatbot`);
}







////////////////////////////////////////////////////////////////////////////////
//////////////////////////// INSERT INTO DATABASE //////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// REGISTER USER -- PUSH USER CREDENTIALS TO DB
module.exports.registerUser = (first, last, email, password) => {

    return db.query(

        `INSERT INTO users (first, last, email, password) VALUES ($1, $2, $3, $4) RETURNING id`,
        [first, last, email, password]

    ).then((results) => {
        return results.rows[0];
    }).catch(err => {
        console.log(err);
    });

};

////////////////////////////////////////////////////////////////////////////////
////////////////////////// END INSERT INTO DATABASE ////////////////////////////
////////////////////////////////////////////////////////////////////////////////






////////////////////////////////////////////////////////////////////////////////
//////////////////////////// RETRIEVE FROM DATABASE ////////////////////////////
////////////////////////////////////////////////////////////////////////////////

// GET USER EMAIL AND PASSWORD FOR LOGIN
module.exports.checkUserCredentialsToLogin = (email) => {

    return db.query(

        `SELECT password, id FROM users WHERE email = $1`,
        [email]

    ).then((results) => {
        return results.rows[0];
    }).catch(err => {
        console.log(err);
    });

};

////////////////////////////////////////////////////////////////////////////////
////////////////////////// END RETRIEVE FROM DATABASE //////////////////////////
////////////////////////////////////////////////////////////////////////////////
